---
// This component fetches public GitHub repositories at build time
interface GitHubRepo {
  id: number;
  name: string;
  description: string;
  html_url: string;
  homepage: string | null;
  language: string | null;
  stargazers_count: number;
  topics: string[];
  updated_at: string;
}

let repos: GitHubRepo[] = [];
let error = null;

try {
  // Fetch public repositories from GitHub
  const response = await fetch('https://api.github.com/users/JashandeepJustinBains/repos?sort=updated&per_page=10');
  
  if (response.ok) {
    const data = await response.json();
    repos = data
      .filter((repo: GitHubRepo) => !repo.name.includes('personal-website')) // Exclude this website
      .slice(0, 6); // Limit to 6 most recent repos
  } else {
    error = `GitHub API returned status ${response.status}`;
  }
} catch (e) {
  error = e instanceof Error ? e.message : 'Failed to fetch repositories';
  console.error('Error fetching GitHub repos:', error);
}
---

<section id="projects">
  <h2>GitHub Projects</h2>
  
  {error ? (
    <div class="card">
      <p>Unable to load GitHub repositories at this time. Please visit my <a href="https://github.com/JashandeepJustinBains" target="_blank" rel="noopener noreferrer">GitHub profile</a> directly.</p>
    </div>
  ) : repos.length > 0 ? (
    <>
      <p class="repos-intro">
        Here are some of my recent public projects from GitHub:
      </p>
      <div class="grid">
        {repos.map((repo) => (
          <div class="card repo-card">
            <h3>
              <a href={repo.html_url} target="_blank" rel="noopener noreferrer">
                {repo.name}
              </a>
            </h3>
            <p>{repo.description || 'No description available'}</p>
            
            {repo.topics && repo.topics.length > 0 && (
              <div class="topics">
                {repo.topics.map((topic) => (
                  <span class="badge tech-badge">{topic}</span>
                ))}
              </div>
            )}
            
            <div class="repo-meta">
              {repo.language && (
                <span class="badge">{repo.language}</span>
              )}
              {repo.stargazers_count > 0 && (
                <span class="stars">⭐ {repo.stargazers_count}</span>
              )}
            </div>
            
            {repo.homepage && (
              <a href={repo.homepage} target="_blank" rel="noopener noreferrer" class="btn btn-secondary" style="margin-top: 0.5rem;">
                View Demo →
              </a>
            )}
          </div>
        ))}
      </div>
      <div style="text-align: center; margin-top: 2rem;">
        <a href="https://github.com/JashandeepJustinBains" target="_blank" rel="noopener noreferrer" class="btn">
          View All Projects on GitHub →
        </a>
      </div>
    </>
  ) : (
    <div class="loading">
      <p>Loading repositories...</p>
    </div>
  )}
</section>

<style>
  .repo-card h3 a {
    color: var(--primary);
  }
  
  .repo-card h3 a:hover {
    color: var(--secondary);
  }
  
  .topics {
    margin: 1rem 0 0.5rem 0;
  }
  
  .repo-meta {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-top: 1rem;
  }
  
  .stars {
    color: var(--text-muted);
    font-size: 0.875rem;
  }
</style>
